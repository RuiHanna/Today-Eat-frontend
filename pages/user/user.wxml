<!--user.wxml-->
<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <!-- ç”¨æˆ·ä¿¡æ¯å±•ç¤º -->
    <view class="userinfo">
      <!-- æœªç™»å½• -->
      <block wx:if="{{!loggedIn}}">
        <button class="login-button" bindtap="onLogin">å¾®ä¿¡ä¸€é”®ç™»å½•</button>
      </block>
      <!-- ç™»å½•å -->
      <block wx:else>
        <!-- ç”¨æˆ·ä¿¡æ¯ç¼–è¾‘åŒºåŸŸï¼šå¤´åƒ + æ˜µç§° + æŒ‰é’® -->
        <view class="profile-edit">
          <!-- å·¦ä¾§å¤´åƒ -->
          <button class="avatar-wrapper" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
            <image class="userinfo-avatar" src="{{user.avatarUrl}}" mode="cover"></image>
          </button>

          <!-- å³ä¾§æ˜µç§°å’Œä¿å­˜ -->
          <view class="nickname-side">
            <view class="nickname-wrapper">
              <text class="nickname-label">æ˜µç§°</text>
              <input class="nickname-input" value="{{user.nickname}}" bind:input="onNicknameInput" />
            </view>
            <button class="save-button" bindtap="onSaveProfile">ä¿å­˜ä¿®æ”¹</button>
          </view>
        </view>


        <!-- æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ -->
        <view class="stats">
          <text>ğŸ± åƒäº†å¤šå°‘é¤?ï¼š{{user.mealCount}}</text>
          <text>ğŸ­ å–œæ¬¢çš„å£å‘³ï¼š{{user.favoriteTaste}}</text>
          <text>ğŸ˜‹ å¿ƒæƒ…ã€Œ{{user.commonMood}}ã€æ—¶å–œæ¬¢åƒï¼š{{user.moodFood}}</text>
        </view>
      </block>
    </view>
    <!-- æˆ‘çš„æ”¶è— -->
    <view class="section">
      <view class="section-header" bindtap="toggleFavorites">
        <text>æˆ‘çš„æ”¶è—</text>
        <text wx:if="{{showFavorites}}">â–²</text>
        <text wx:else>â–¼</text>
      </view>
      <view wx:if="{{showFavorites}}" class="section-content">
        <block wx:for="{{favorites}}" wx:key="index">
          <view class="dish-item">{{item.name}}</view>
        </block>
      </view>
    </view>
    <!-- æ¨èå†å² -->
    <view class="section">
      <view class="section-header" bindtap="toggleHistory">
        <text>æ¨èå†å²</text>
        <text wx:if="{{showHistory}}">â–²</text>
        <text wx:else>â–¼</text>
      </view>
      <view wx:if="{{showHistory}}" class="section-content">
        <block wx:for="{{history}}" wx:key="index">
          <view class="dish-item">{{item.name}}</view>
        </block>
      </view>
    </view>
  </view>
</scroll-view>